@using KikoleSite.Helpers
@inject Microsoft.AspNetCore.Mvc.Localization.IViewLocalizer localizer
@model LeaderboardModel

<h3>@localizer["DailyLeaderboard"]</h3>
<div class="smallTopMargin">
    <label class="mainFormSectionLabelSmall">@localizer["SortType"]</label>
    @Html.DropDownListFor(m => m.DaySortType, Model.DaySortTypes.Select(x => new SelectListItem(x.GetLabel(), x.ToString())))
</div>
<div class="smallTopMargin">
    <label class="mainFormSectionLabelSmall">@localizer["Date"]</label>
    @Html.EditorFor(m => m.LeaderboardDay)
</div>
<table id="dailyLeaderboardTable" class="smallTopMargin">
    <thead>
        <tr>
            <th class="tabDataHead">@localizer["PosShortHeader"]</th>
            <th class="tabDataHead redtext">@localizer["UsernameHeader"]</th>
            <th class="tabDataHead">@localizer["TimeHeader"]</th>
            <th class="tabDataHead">@localizer["PointsHeader"]</th>
        </tr>
    </thead>
    <tbody>
        @{
            var i = 0;
            var lastRank = 1;
        }
        @foreach (var leader in Model.Dayboard.Leaders)
        {
            var trClass = leader.IsCreator ? "creator" : (i % 2 == 0 ? "even" : "odd");
            <tr class="@trClass">
                <td class="tabData">@leader.Rank</td>
                <td class="tabData redtext"><a href="/Leaderboard?userId=@leader.UserId">@leader.UserName</a></td>
                <td class="tabData">@leader.TimeString</td>
                <td class="tabData">@leader.Points</td>
            </tr>
            lastRank = leader.Rank + 1;
            i++;
        }
        @foreach (var search in Model.Dayboard.Searchers)
        {
            var trClass = i % 2 == 0 ? "even" : "odd";
            <tr class="@trClass">
                <td class="tabData">@lastRank</td>
                <td class="tabData redtext"><a href="/Leaderboard?userId=@search.UserId">@search.UserName</a></td>
                <td class="tabData">@localizer["NotYetTime"]</td>
                <td class="tabData">@localizer["NotYetPoints"]</td>
            </tr>
            i++;
        }
        @if (i == 0)
        {
            <tr class="even">
                <td colspan="4" class="tabData">@localizer["NoUserInTable"]</td>
            </tr>
        }
    </tbody>
</table>

<h3>@localizer["GeneralLeaderboard"]</h3>
<div class="smallTopMargin">
    <label class="mainFormSectionLabelSmall">@localizer["SortType"]</label>
    @Html.DropDownListFor(m => m.SortType, Model.SortTypes.Select(x => new SelectListItem(x.GetLabel(), x.ToString())))
</div>
<div class="smallTopMargin">
    <label class="mainFormSectionLabelSmall">@localizer["FromDate"]</label>
    @Html.EditorFor(m => m.MinimalDate)
</div>
<div class="smallTopMargin">
    <label class="mainFormSectionLabelSmall">@localizer["ToDate"]</label>
    @Html.EditorFor(m => m.MaximalDate)
</div>
<table id="globalLeaderboardTable" class="smallTopMargin">
    <thead>
        <tr>
            <th class="tabDataHead">@localizer["PosShortHeader"]</th>
            <th class="tabDataHead redtext">@localizer["UsernameHeader"]</th>
            <th class="tabDataHead">@localizer["PointsHeader"]</th>
            <th class="tabDataHead">@localizer["BestTimeHeader"]</th>
            <th class="tabDataHead">@localizer["FoundHeader"]</th>
            <th class="tabDataHead">@localizer["AttemptedHeader"]</th>
            <th class="tabDataHead">@localizer["ProposedHeader"]</th>
        </tr>
    </thead>
    <tbody>
        @{
            i = 0;
        }
        @if (Model.GlobalLeaderboard.Count > 0)
        {
            i = 0;
            foreach (var leader in Model.GlobalLeaderboard)
            {
                var trClass = i % 2 == 0 ? "even" : "odd";
                <tr class="@trClass">
                    <td class="tabData">@leader.Rank</td>
                    <td class="tabData redtext"><a href="/Leaderboard?userId=@leader.UserId">@leader.UserName</a></td>
                    <td class="tabData">@leader.Points</td>
                    <td class="tabData">@leader.BestTimeString</td>
                    <td class="tabData">@leader.KikolesFound</td>
                    <td class="tabData">@leader.KikolesAttempted</td>
                    <td class="tabData">@leader.KikolesProposed</td>
                </tr>
                i++;
            }
        }
        else
        {
            <tr class="even">
                <td colspan="7" class="tabData">@localizer["NoUserInTable"]</td>
            </tr>
        }
    </tbody>
</table>

<h3>@localizer["NewPageBuilding"]</h3>
<a href="/Leaderboard/Stats">@localizer["StatisticsPageLink"]</a>
<br />
<a href="/Leaderboard/Palmares">@localizer["PalmaresLink"]</a>
<br />
<a href="/Leaderboard/KikolesStats">@localizer["KikolesStatisticsPageLink"]</a>

<script>
    $(function () {
        var noUserInTableTextJs = @Html.Raw(Json.Serialize(localizer["NoUserInTable"].Value));
        var noTimeYetTextJs = @Html.Raw(Json.Serialize(localizer["NotYetTime"].Value));
        var noPointsYetTextJs = @Html.Raw(Json.Serialize(localizer["NotYetPoints"].Value));

        /* global */
        var sortType = document.getElementById('SortType');
        var fromDate = document.getElementById('MinimalDate');
        var toDate = document.getElementById('MaximalDate');
        sortType.onchange = function () {
            loadGlobalLeaderboard(sortType.value, fromDate.value, toDate.value, noUserInTableTextJs);
        };
        fromDate.onchange = function () {
            loadGlobalLeaderboard(sortType.value, fromDate.value, toDate.value, noUserInTableTextJs);
        };
        toDate.onchange = function () {
            loadGlobalLeaderboard(sortType.value, fromDate.value, toDate.value, noUserInTableTextJs);
        };

        /* daily */
        var dailySortType = document.getElementById('DaySortType');
        var dailyDate = document.getElementById('LeaderboardDay');
        dailySortType.onchange = function () {
            loadDailyLeadeboard(dailySortType.value, dailyDate.value, noUserInTableTextJs, noTimeYetTextJs, noPointsYetTextJs);
        };
        dailyDate.onchange = function () {
            loadDailyLeadeboard(dailySortType.value, dailyDate.value, noUserInTableTextJs, noTimeYetTextJs, noPointsYetTextJs);
        };
    });
</script>